module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e){t.exports=require("axios")},function(t,e){t.exports=require("source-map-support/register")},function(t,e){t.exports=require("bson")},function(t,e){t.exports=require("debug")},function(t,e){t.exports=require("axios-retry")},function(t,e){t.exports=require("regenerator-runtime")},function(t,e,r){"use strict";r.r(e);r(1),r(5);var n=r(0),i=r.n(n),a=r(4),o=r.n(a),s=r(2),u=r.n(s).a.ObjectId,c=function(t){return"[object Object]"===Object.prototype.toString.call(t)},p=Array.isArray,l=function(t){return"boolean"==typeof t},h=function(t){return function(t){throw t}(new Error("Missing parameter: "+t))};function f(t){try{var e=t.toString();return e===new u(e).toString()}catch(t){return!1}}var d=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=JSON.parse(s.EJSON.stringify(t,{relaxed:!0}));function n(t){for(var e in t)!1!==t.hasOwnProperty(e)&&"$oid"!==e&&(c(t[e])?t[e]=n(t[e]):p(t[e])?t[e]=t[e].map((function(t){return c(t)?n(t):f(t)?new u(t):void 0})):f(t[e])&&(t[e]=new u(t[e])));return t}return e.raw||n(r),JSON.parse(s.EJSON.stringify(r,{relaxed:!0}))},v=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=s.EJSON.parse(s.EJSON.stringify(t,{relaxed:!0}),{relaxed:!0});function n(t){for(var e in t)!1!==t.hasOwnProperty(e)&&(c(t[e])&&!f(t[e])?t[e]=n(t[e]):p(t[e])?t[e]=t[e].map((function(t){return c(t)&&!f(t)?n(t):f(t)?t.toString():void 0})):f(t[e])&&(t[e]=t[e].toString()));return t}return e.raw||n(r),r};function m(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function g(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){m(a,n,i,o,s,"next",t)}function s(t){m(a,n,i,o,s,"throw",t)}o(void 0)}))}}o()(i.a,{retries:3});var b,y,w,k,x,O=r(3)("mongooseclient:axios"),j=function(t,e){return O(`\n    url: ${t.config.url}\n    method: ${t.config.method}\n    status: ${t.status}\n    params: ${JSON.stringify(t.config.params)}\n    data: ${JSON.stringify(t.config.data)}\n    isError: ${!!e}\n`)},_=(b=g(regeneratorRuntime.mark((function t(e){var r,n,a,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.url,n=void 0===r?h`url`:r,a=e.token,o=e.params,s=void 0===o?{}:o,t.prev=1,t.next=4,i()({method:"get",url:n,timeout:3e3,headers:Object.assign(a?{Authorization:"Bearer "+a}:{},{"Content-Type":"application/json;charset=UTF-8"}),params:s});case 4:return u=t.sent,j(u),t.abrupt("return",[u.data,u]);case 9:throw t.prev=9,t.t0=t.catch(1),t.t0.response&&j(t.t0.response,!0),t.t0;case 13:case"end":return t.stop()}}),t,null,[[1,9]])}))),function(t){return b.apply(this,arguments)}),$=(y=g(regeneratorRuntime.mark((function t(e){var r,n,a,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.url,n=void 0===r?h`url`:r,a=e.token,o=e.params,s=e.data,t.prev=1,t.next=4,i()({method:"post",url:n,timeout:3e3,headers:Object.assign(a?{Authorization:"Bearer "+a}:{},{"Content-Type":"application/json;charset=UTF-8"}),data:s,params:o});case 4:return u=t.sent,j(u),t.abrupt("return",[u.data,u]);case 9:throw t.prev=9,t.t0=t.catch(1),t.t0.response&&j(t.t0.response,!0),t.t0;case 13:case"end":return t.stop()}}),t,null,[[1,9]])}))),function(t){return y.apply(this,arguments)}),P=(w=g(regeneratorRuntime.mark((function t(e){var r,n,a,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.url,n=void 0===r?h`url`:r,a=e.token,o=e.params,s=e.data,t.prev=1,t.next=4,i()({method:"patch",url:n,timeout:3e3,headers:Object.assign(a?{Authorization:"Bearer "+a}:{},{"Content-Type":"application/json;charset=UTF-8"}),data:s,params:o});case 4:return u=t.sent,j(u),t.abrupt("return",[u.data,u]);case 9:throw t.prev=9,t.t0=t.catch(1),t.t0.response&&j(t.t0.response,!0),t.t0;case 13:case"end":return t.stop()}}),t,null,[[1,9]])}))),function(t){return w.apply(this,arguments)}),R=(k=g(regeneratorRuntime.mark((function t(e){var r,n,a,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.url,n=void 0===r?h`url`:r,a=e.token,o=e.params,s=e.data,t.prev=1,t.next=4,i()({method:"put",url:n,timeout:3e3,headers:Object.assign(a?{Authorization:"Bearer "+a}:{},{"Content-Type":"application/json;charset=UTF-8"}),data:s,params:o});case 4:return u=t.sent,j(u),t.abrupt("return",[u.data,u]);case 9:throw t.prev=9,t.t0=t.catch(1),t.t0.response&&j(t.t0.response,!0),t.t0;case 13:case"end":return t.stop()}}),t,null,[[1,9]])}))),function(t){return k.apply(this,arguments)}),S=(x=g(regeneratorRuntime.mark((function t(e){var r,n,a,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.url,n=void 0===r?h`url`:r,a=e.token,o=e.params,s=e.data,t.prev=1,t.next=4,i()({method:"delete",url:n,timeout:3e3,headers:Object.assign(a?{Authorization:"Bearer "+a}:{},{"Content-Type":"application/json;charset=UTF-8"}),data:s,params:o});case 4:return u=t.sent,j(u),t.abrupt("return",[u.data,u]);case 9:throw t.prev=9,t.t0=t.catch(1),t.t0.response&&j(t.t0.response,!0),t.t0;case 13:case"end":return t.stop()}}),t,null,[[1,9]])}))),function(t){return x.apply(this,arguments)});function A(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return z(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function E(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function T(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){E(a,n,i,o,s,"next",t)}function s(t){E(a,n,i,o,s,"throw",t)}o(void 0)}))}}function U(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function N(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var J=r(3)("mongooseclient:app"),L=function(){function t(e){var r=e.token,n=e.database,i=void 0===n?h`database`:n,a=e.baseUrl,o=e.cluster;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),N(this,"token",void 0),N(this,"database",void 0),N(this,"cluster",void 0),N(this,"baseUrl","http://localhost"),a&&(this.baseUrl=a),this.database=i,this.cluster=o,this.token=r,J(`Connected to ${this.database}${this.cluster?"on cluster "+this.cluster:""} at ${this.baseUrl}`)}var e,r,n,i,a,o,s,u,c,p;return e=t,(r=[{key:"createCollection",value:(p=T(regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s,u=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=u.length>0&&void 0!==u[0]?u[0]:{},t.prev=1,r=e.collection,n=e.database||this.database,i=`${this.baseUrl}/${this.cluster?`clusters/${this.cluster}/`:""}${n}/${r}`,t.next=7,R({url:i,token:this.token,data:{description:""}});case 7:return a=t.sent,o=A(a,1),s=o[0],t.abrupt("return",s);case 13:throw t.prev=13,t.t0=t.catch(1),t.t0;case 16:case"end":return t.stop()}}),t,this,[[1,13]])}))),function(){return p.apply(this,arguments)})},{key:"listCollections",value:(c=T(regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:{},t.prev=1,r=e.database||this.database,n=`${this.baseUrl}/${this.cluster?`clusters/${this.cluster}/`:""}${r}`,t.next=6,_({url:n,token:this.token});case 6:return i=t.sent,a=A(i,1),o=a[0],t.abrupt("return",o);case 12:throw t.prev=12,t.t0=t.catch(1),t.t0;case 15:case"end":return t.stop()}}),t,this,[[1,12]])}))),function(){return c.apply(this,arguments)})},{key:"listDocuments",value:(u=T(regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s,u,c,p,l,h,f,d,v=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=v.length>0&&void 0!==v[0]?v[0]:{}).collection){t.next=3;break}throw new Error("must have a collection");case 3:return t.prev=3,r=e.collection,n=e.database||this.database,i=e.filter,a=e.count,o=e.keys,s=e.sort,u=e.page,c=e.pagesize,p=`${this.baseUrl}/${this.cluster?`clusters/${this.cluster}/`:""}${n}/${r}`,l={filter:i,count:a,keys:o,sort:s,page:u,pagesize:c},t.next=11,_({url:p,token:this.token,params:l});case 11:if(t.t0=t.sent,t.t0){t.next=14;break}t.t0={};case 14:return h=t.t0,f=A(h,1),d=f[0],t.abrupt("return",d);case 20:if(t.prev=20,t.t1=t.catch(3),!t.t1.response||404!==t.t1.response.status){t.next=24;break}return t.abrupt("return",[]);case 24:throw t.t1;case 25:case"end":return t.stop()}}),t,this,[[3,20]])}))),function(){return u.apply(this,arguments)})},{key:"count",value:(s=T(regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s,u,c,p,l,h=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=h.length>0&&void 0!==h[0]?h[0]:{}).collection){t.next=3;break}throw new Error("must have a collection");case 3:return t.prev=3,r=e.collection,n=e.database||this.database,i=e.filter,a=e.page,o=e.pagesize,s=`${this.baseUrl}/${this.cluster?`clusters/${this.cluster}/`:""}${n}/${r}`,u={filter:i,count:!0,page:a,pagesize:o},t.next=11,_({url:s,token:this.token,params:u});case 11:return c=t.sent,p=A(c,1),l=p[0],t.abrupt("return",l);case 17:throw t.prev=17,t.t0=t.catch(3),t.t0;case 20:case"end":return t.stop()}}),t,this,[[3,17]])}))),function(){return s.apply(this,arguments)})},{key:"insert",value:(o=T(regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s,u,c,p,l=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=l.length>0&&void 0!==l[0]?l[0]:{},r=l.length>1&&void 0!==l[1]&&l[1],e.collection){t.next=4;break}throw new Error("must have a collection");case 4:if(e.document){t.next=6;break}throw new Error("must have a document");case 6:return t.prev=6,n=e.collection,i=e.database||this.database,a=e.document,o=`${this.baseUrl}/${this.cluster?`clusters/${this.cluster}/`:""}${i}/${n}`,t.next=13,$({url:o,token:this.token,data:a});case 13:return s=t.sent,(u=A(s,2))[0],c=u[1],p=c.headers.etag,t.next=20,this.listDocuments(Object.assign({},e,{filter:JSON.stringify({_etag:{$oid:p}})}));case 20:return t.abrupt("return",t.sent);case 23:if(t.prev=23,t.t0=t.catch(6),t.prev=25,!t.t0.response||404!==t.t0.response.status||r){t.next=32;break}return t.next=29,this.createCollection(e);case 29:return t.next=31,this.insert(e,!0);case 31:return t.abrupt("return",t.sent);case 32:t.next=37;break;case 34:throw t.prev=34,t.t1=t.catch(25),t.t1;case 37:throw t.t0;case 38:case"end":return t.stop()}}),t,this,[[6,23],[25,34]])}))),function(){return o.apply(this,arguments)})},{key:"update",value:(a=T(regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s,u,c,p,l,h,f,d,v,m=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=m.length>0&&void 0!==m[0]?m[0]:{}).collection){t.next=3;break}throw new Error("must have a collection");case 3:if(e.document){t.next=5;break}throw new Error("must have a document");case 5:if(!Array.isArray(e.document)){t.next=9;break}if(!e.document.find((function(t){return 0==!!t._id}))){t.next=9;break}throw new Error("_id is required");case 9:if(t.prev=9,r=e.collection,n=e.database||this.database,i=e.document,a=e.filter,o=e.key,s={filter:a,key:o},!Array.isArray(i)){t.next=25;break}return u=`${this.baseUrl}/${this.cluster?`clusters/${this.cluster}/`:""}${n}/${r}`,t.next=19,$({url:u,token:this.token,data:i,params:s});case 19:return c=t.sent,p=A(c,1),l=p[0],t.abrupt("return",l);case 25:return h=`${this.baseUrl}/${this.cluster?`clusters/${this.cluster}/`:""}${n}/${r}/*`,t.next=28,P({url:h,token:this.token,data:i,params:s});case 28:return f=t.sent,d=A(f,1),v=d[0],t.abrupt("return",v);case 32:t.next=37;break;case 34:throw t.prev=34,t.t0=t.catch(9),t.t0;case 37:case"end":return t.stop()}}),t,this,[[9,34]])}))),function(){return a.apply(this,arguments)})},{key:"delete",value:(i=T(regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s,u,c,p,l=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=l.length>0&&void 0!==l[0]?l[0]:{}).collection){t.next=3;break}throw new Error("must have a collection");case 3:if(e.document){t.next=5;break}throw new Error("must have a document");case 5:return t.prev=5,r=e.collection,n=e.database||this.database,i=e.document,a=e.filter,o=`${this.baseUrl}/${this.cluster?`clusters/${this.cluster}/`:""}${n}/${r}/*`,s={filter:a},t.next=14,S({url:o,token:this.token,data:i,params:s});case 14:return u=t.sent,c=A(u,1),p=c[0],t.abrupt("return",p);case 20:throw t.prev=20,t.t0=t.catch(5),t.t0;case 23:case"end":return t.stop()}}),t,this,[[5,20]])}))),function(){return i.apply(this,arguments)})}])&&U(e.prototype,r),n&&U(e,n),t}();function C(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var D=function(){function t(e){var r=e.name,n=void 0===r?h`name`:r,i=e.params,a=void 0===i?{}:i,o=e.options,s=void 0===o?{}:o,u=e.supported,c=void 0===u?{}:u,p=e.resolver,l=void 0===p?h`resolver`:p;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Object.assign(this,{params:a,name:n,options:s,resolver:l,supported:c})}var e,r,n,i,a;return e=t,(r=[{key:"isSupported",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`methodName`;if(this.supported[t])return!0;throw new Error(`${this.name} does not support method ${t}`)}},{key:"then",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`resolve`,e=arguments.length>1?arguments[1]:void 0;return this.exec(this.options).then(t).catch(e)}},{key:"catch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`func`;return this.then(Promise.resolve.bind(Promise),Promise.reject.bind(Promise)).catch(t)}},{key:"exec",value:(i=regeneratorRuntime.mark((function t(){var e,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]?r[0]:{},t.prev=1,e=Object.assign({},this.options,e),this.resolver){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,this.resolver(e,this.params);case 7:return t.abrupt("return",t.sent);case 10:throw t.prev=10,t.t0=t.catch(1),t.t0;case 13:case"end":return t.stop()}}),t,this,[[1,10]])})),a=function(){var t=this,e=arguments;return new Promise((function(r,n){var a=i.apply(t,e);function o(t){C(a,r,n,o,s,"next",t)}function s(t){C(a,r,n,o,s,"throw",t)}o(void 0)}))},function(){return a.apply(this,arguments)})},{key:"page",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.options.noPageLimit)throw new Error("page method cannot be used when noPageLimit is true");try{if(this.isSupported("page"))return this.params.page=t,this}catch(t){throw t}}},{key:"limit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{if(this.isSupported("limit"))return this.options.limit=t,t>this.options.pagesize?(this.params.pagesize=this.options.pagesize,this.options.noPageLimit=!0):this.params.pagesize=t||this.options.pagesize,this.options.skip?this.skip(this.options.skip):this}catch(t){throw t}}},{key:"skip",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var r=function(e,r){if(!(e<r)){(function(t){for(var e=2,r=Math.sqrt(t);e<=r;e++)if(t%e==0)return!1;return t>1})(e)&&(t.options.skipIsPrime=!0,e-=1);for(var n=2;n<e;n++)if(e%n==0&&e/n<=2*r&&e/n>=r)return n}};if(this.isSupported("skip")){var n=this.params.pagesize||this.options.pagesize;this.options.skip=e,this.options.og_pagesize=n;var i=r(e,n/2);return i?(this.options.skipIsPrime&&(e-=1),this.params.pagesize=e/i,this.params.page=i+1):(this.options.skipIsPrime&&(e-=1),this.params.pagesize=e<=n?e:n,this.params.page=e<=n?2:1),!1===this.options.noPageLimit&&(this.options.limit=this.options.og_pagesize),this.options.noPageLimit=!0,this}}catch(t){throw t}}},{key:"sort",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`value`;try{if(this.isSupported("sort"))return this.params.sort=JSON.stringify(t),this}catch(t){throw t}}},{key:"select",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{if(this.isSupported("select"))return c(t)?(this.params.keys=t,this):(this.params.keys=JSON.stringify(t.split(" ").reduce((function(t,e){return Object.assign({[""+e]:1})}),{})),this)}catch(t){throw t}}},{key:"raw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{if(this.isSupported("raw"))return this.options.raw=t,this}catch(t){throw t}}},{key:"noPageLimit",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{if(this.isSupported("noPageLimit")){if(l(t)){var e=this.options,r=e.noPageLimit,n=e.pagesize;return!0===t?this.options.noPageLimit={batchesOf:r&&r.batchesOf||n}:!1===t&&(this.options.noPageLimit=!1),this}var i=t.batchesOf;return this.options.noPageLimit={batchesOf:i||this.options.pagesize},this}}catch(t){throw t}}},{key:"populate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(this.isSupported("populate"))return this.options.sort=t,this}catch(t){throw t}}}])&&q(e.prototype,r),n&&q(e,n),t}();function M(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function I(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){M(a,n,i,o,s,"next",t)}function s(t){M(a,n,i,o,s,"throw",t)}o(void 0)}))}}function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function G(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var H=r(3)("mongooseclient:template"),K=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`collection`,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h`connection`,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(B(this,t),G(this,"collection",void 0),G(this,"connection",void 0),G(this,"options",void 0),this.collection=e,this.connection=r,!this.collection)throw new Error("Template class requires a collection");if(!this.connection)throw new Error("Template class requires a connection");this.options=n}var e,r,n;return e=t,(r=[{key:"findOne",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.connection,i=Object.assign({collection:this.collection,pagesize:1},Object.keys(e).length>0?{filter:JSON.stringify(d(e,Object.assign({},this.options,r)))}:{},r),a={select:1,raw:1};return new D({params:i,options:Object.assign({},this.options,r),name:"findOne",supported:a,resolver:(t=I(regeneratorRuntime.mark((function t(){var e,r,i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1&&void 0!==a[1]?a[1]:h`params`,t.prev=2,t.next=5,n.listDocuments(r);case 5:return i=t.sent,e.raw||(i=v(i,e)),t.abrupt("return",i._embedded?i._embedded[0]:void 0);case 10:throw t.prev=10,t.t0=t.catch(2),t.t0;case 13:case"end":return t.stop()}}),t,null,[[2,10]])}))),function(){return t.apply(this,arguments)})})}},{key:"find",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.connection,i=Object.assign({collection:this.collection},Object.keys(e).length>0?{filter:JSON.stringify(d(e,Object.assign({},this.options,r)))}:{},r),a={populate:1,select:1,raw:1,skip:1,limit:1,page:1,sort:1,noPageLimit:1};return new D({params:i,options:Object.assign({},this.options,r),name:"find",supported:a,resolver:(t=I(regeneratorRuntime.mark((function t(){var e,r,i,a,o,s,u,c,p,l,f,d,m=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=m.length>0&&void 0!==m[0]?m[0]:{},r=m.length>1&&void 0!==m[1]?m[1]:h`params`,H({options:e,params:r}),i=[],t.prev=4,!e.noPageLimit){t.next=30;break}return t.next=8,n.count(r);case 8:a=t.sent,o=a._total_pages,s=a._returned,u=a._embedded,i=i.concat(u),c=[],p=0,l=r.page||1;case 16:if(!(l<o)){t.next=24;break}if(p++,!(e.limit&&p*s>e.limit)){t.next=20;break}return t.abrupt("break",24);case 20:c.push(n.listDocuments(Object.assign({},r,{pagesize:s,page:l+1})));case 21:l++,t.next=16;break;case 24:return t.next=26,Promise.all(c);case 26:t.sent.forEach((function(t){var e=t._embedded;return i=i.concat(e)})),t.next=38;break;case 30:return t.next=32,n.listDocuments(r);case 32:if(t.t0=t.sent,t.t0){t.next=35;break}t.t0={};case 35:f=t.t0,d=f._embedded,i=d||[];case 38:if(H("response length:",i.length),e.skip&&(i=e.skip<e.og_pagesize||1===r.page?i.slice(e.noPageLimit?0:e.skip,i.length):i.slice(e.skipIsPrime?1:0,e.noPageLimit?i.length:e.og_pagesize+(e.skipIsPrime?1:0))),e.limit&&(i=i.slice(0,e.limit)),e.raw){t.next=43;break}return t.abrupt("return",v(i,e));case 43:return t.abrupt("return",i);case 46:throw t.prev=46,t.t1=t.catch(4),t.t1;case 49:case"end":return t.stop()}}),t,null,[[4,46]])}))),function(){return t.apply(this,arguments)})})}},{key:"create",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`document`,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Array.isArray(e)||(r.originallyObject=!0,e=[e]);var n=this.connection;e=e.map((function(e){return Object.assign({},e,t.timestamps)}));var i,a=Object.assign({collection:this.collection,document:d(e,Object.assign({},this.options,r))},r),o={raw:1};return new D({params:a,options:Object.assign({},this.options,r),name:"create",supported:o,resolver:(i=I(regeneratorRuntime.mark((function t(){var e,r,i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1&&void 0!==a[1]?a[1]:h`params`,H({options:e,params:r}),t.prev=3,t.next=6,n.insert(r);case 6:return i=t.sent,!e.raw&&i&&(i=v(i,e)),t.abrupt("return",e.originallyObject?i._embedded?i._embedded[0]:void 0:i._embedded);case 11:throw t.prev=11,t.t0=t.catch(3),t.t0;case 14:case"end":return t.stop()}}),t,null,[[3,11]])}))),function(){return i.apply(this,arguments)})})}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`query`,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};p(t)&&(e=t,t={});var n,i=this.connection,a=Object.assign({collection:this.collection,document:d(Object.assign(e,this.__updatedAt),this.options)},Object.keys(t).length>0?{filter:JSON.stringify(d(t,Object.assign({},this.options,r)))}:{},r);return new D({params:a,options:Object.assign({},this.options,r),name:"update",resolver:(n=I(regeneratorRuntime.mark((function t(){var e,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.length>0&&void 0!==r[0]&&r[0],e=r.length>1&&void 0!==r[1]?r[1]:h`params`,t.prev=2,t.next=5,i.update(e);case 5:return t.abrupt("return",t.sent);case 8:throw t.prev=8,t.t0=t.catch(2),t.t0;case 11:case"end":return t.stop()}}),t,null,[[2,8]])}))),function(){return n.apply(this,arguments)})})}},{key:"count",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.connection,i=Object.assign({collection:this.collection,pagesize:1},Object.keys(e).length>0?{filter:JSON.stringify(d(e,Object.assign({},this.options,r)))}:{},r);return new D({params:i,options:Object.assign({},this.options,r),name:"count",resolver:(t=I(regeneratorRuntime.mark((function t(){var e,r,i=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.length>0&&void 0!==i[0]&&i[0],e=i.length>1&&void 0!==i[1]?i[1]:h`params`,t.prev=2,t.next=5,n.count(e);case 5:return r=t.sent,t.abrupt("return",r._size);case 9:throw t.prev=9,t.t0=t.catch(2),t.t0;case 12:case"end":return t.stop()}}),t,null,[[2,9]])}))),function(){return t.apply(this,arguments)})})}},{key:"remove",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`document`,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.connection,i=Object.assign({collection:this.collection,document:d(e,this.options)},e?{filter:JSON.stringify(d(e,Object.assign({},this.options,r)))}:{},r);return new D({params:i,options:Object.assign({},this.options,r),name:"destroy",resolver:(t=I(regeneratorRuntime.mark((function t(){var e,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.length>0&&void 0!==r[0]&&r[0],e=r.length>1&&void 0!==r[1]?r[1]:h`params`,t.prev=2,t.next=5,n.delete(e);case 5:return t.abrupt("return",t.sent);case 8:throw t.prev=8,t.t0=t.catch(2),t.t0;case 11:case"end":return t.stop()}}),t,null,[[2,8]])}))),function(){return t.apply(this,arguments)})})}},{key:"__updatedAt",get:function(){var t=this.options.timestamps;if(!t||!t.updated_at)return{};var e=t.updated_at;return{$currentDate:{[""+("string"==typeof e?e:"updated_at")]:!0}}}},{key:"__createdAt",get:function(){var t=this.options.timestamps;if(!t||!t.created_at)return{};var e=t.created_at;return{$currentDate:{[""+("string"==typeof e?e:"created_at")]:!0}}}},{key:"timestamps",get:function(){return this.__updatedAt||this.__createdAt?!this.__updatedAt&&this.__createdAt?this.__createdAt:!this.__createdAt&&this.__updatedAt?this.__updatedAt:{$currentDate:Object.assign({},this.__createdAt.$currentDate,this.__updatedAt.$currentDate)}:{}}}])&&F(e.prototype,r),n&&F(e,n),t}();function Q(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function V(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function X(t,e){return(X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=et(t);if(e){var i=et(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Z(this,r)}}function Z(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?tt(t):e}function tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function et(t){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(s,t);var e,r,n,i,a,o=Y(s);function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.token,n=e.database,i=void 0===n?h`database`:n,a=e.baseUrl,u=e.cluster,c=e.options;return V(this,s),rt(tt(t=o.call(this,{database:i,baseUrl:a,cluster:u,token:r})),"options",{noPageLimit:!1,pagesize:100,timestamps:{created_at:1,updated_at:1}}),Object.assign(t.options,c),t}return e=s,(r=[{key:"getModels",value:(i=regeneratorRuntime.mark((function t(){var e,r,n,i=this,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.length>0&&void 0!==a[0]?a[0]:{},t.prev=1,t.next=4,this.listCollections();case 4:return r=t.sent,n=r._embedded.map((function(t){var r=t._id;return new K(r,i,Object.assign(i.options,e))})),t.abrupt("return",n.reduce((function(t,e){return Object.assign(t,{[""+e.collection]:e})}),{}));case 9:throw t.prev=9,t.t0=t.catch(1),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,9]])})),a=function(){var t=this,e=arguments;return new Promise((function(r,n){var a=i.apply(t,e);function o(t){Q(a,r,n,o,s,"next",t)}function s(t){Q(a,r,n,o,s,"throw",t)}o(void 0)}))},function(){return a.apply(this,arguments)})},{key:"getModel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h`name`,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)throw new Error("Model name is required");return new K(t,this,Object.assign(this.options,e))}}])&&W(e.prototype,r),n&&W(e,n),s}(L);e.default=nt}]);